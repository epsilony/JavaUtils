/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package net.epsilony.math.util;


import net.epsilony.math.polynomial.BivariateRealFunction;
import org.apache.commons.math.ArgumentOutsideDomainException;


/**
 *
 * @author epsilon
 */
public class TriangleQuadrature {

    private static final double[][] ts,  wxs,  Wys,  xs;


    static {
        ts = new double[10][];
        wxs = new double[10][];
        Wys = new double[10][];
        xs = new double[10][];

        xs[0] = new double[]{2 / 3};
        wxs[0] = new double[]{0.500000000000000};
        Wys[0] = new double[]{1};
        ts[0] = new double[]{0.500000000000000};

        xs[1] = new double[]{
                    0.355051025721682,
                    0.844948974278318};
        wxs[1] = new double[]{
                    0.181958618256023,
                    0.318041381743977};
        Wys[1] = new double[]{
                    0.5,
                    0.5};
        ts[1] = new double[]{
                    0.211324865405187,
                    0.788675134594813};

        xs[2] = new double[]{
                    0.212340538239153,
                    0.590533135559265,
                    0.911412040487296};
        wxs[2] = new double[]{
                    0.069826979901454,
                    0.229241106359586,
                    0.200931913738959};
        Wys[2] = new double[]{
                    0.277777777777777,
                    0.444444444444444,
                    0.277777777777777};
        ts[2] = new double[]{
                    0.112701665379258,
                    0.500000000000000,
                    0.887298334620742};

        xs[3] = new double[]{
                    0.139759864343781,
                    0.416409567631083,
                    0.723156986361876,
                    0.942895803885482};
        wxs[3] = new double[]{
                    0.031180970950008,
                    0.129847547608232,
                    0.203464568010271,
                    0.135506913431488};
        Wys[3] = new double[]{
                    0.173927422568726,
                    0.326072577431273,
                    0.326072577431273,
                    0.173927422568726};

        ts[3] = new double[]{
                    0.069431844202974,
                    0.330009478207572,
                    0.669990521792428,
                    0.930568155797026};

        xs[4] = new double[]{
                    0.098535085798826,
                    0.304535726646364,
                    0.562025189752614,
                    0.801986582126392,
                    0.960190142948531};
        wxs[4] = new double[]{
                    0.015747914521692,
                    0.073908870072617,
                    0.146386987084670,
                    0.167174638094370,
                    0.096781590226651};
        Wys[4] = new double[]{
                    0.118463442528094,
                    0.239314335249683,
                    0.284444444444444,
                    0.239314335249683,
                    0.118463442528094};
        ts[4] = new double[]{
                    0.046910077030668,
                    0.230765344947158,
                    0.500000000000000,
                    0.769234655052841,
                    0.953089922969332};

        xs[5] = new double[]{
                    0.073054328680259,
                    0.230766137969945,
                    0.441328481228450,
                    0.663015309718846,
                    0.851921400331516,
                    0.970683572840215};
        wxs[5] = new double[]{
                    0.008738301813610,
                    0.043955165550509,
                    0.098661150890655,
                    0.140792553788199,
                    0.135542497231519,
                    0.072310330725509};
        Wys[5] = new double[]{
                    0.085662246189585,
                    0.180380786524069,
                    0.233956967286345,
                    0.233956967286345,
                    0.180380786524069,
                    0.085662246189585};
        ts[5] = new double[]{
                    0.033765242898424,
                    0.169395306766868,
                    0.380690406958402,
                    0.619309593041598,
                    0.830604693233132,
                    0.966234757101576};

        xs[6] = new double[]{
                    0.056262560536922,
                    0.180240691736892,
                    0.352624717113170,
                    0.547153626330555,
                    0.734210177215410,
                    0.885320946839096,
                    0.977520613561287};
        wxs[6] = new double[]{
                    0.005214362202807,
                    0.027408356721873,
                    0.066384696465491,
                    0.107125065695874,
                    0.127390897299589,
                    0.110509258190874,
                    0.055967363423491};
        Wys[6] = new double[]{
                    0.064742483084434,
                    0.139852695744638,
                    0.190915025252559,
                    0.208979591836735,
                    0.190915025252559,
                    0.139852695744638,
                    0.064742483084434};
        ts[6] = new double[]{
                    0.025446043828621,
                    0.129234407200303,
                    0.297077424311301,
                    0.500000000000000,
                    0.702922575688699,
                    0.870765592799697,
                    0.974553956171379};

        xs[7] = new double[]{
                    0.044633955289970,
                    0.144366257042146,
                    0.286824757144431,
                    0.454813315196573,
                    0.628067835416728,
                    0.785691520604369,
                    0.908676392100206,
                    0.982220084852637};
        wxs[7] = new double[]{
                    0.003295191442249,
                    0.017842902655986,
                    0.045439319504699,
                    0.079199599492319,
                    0.106047359435930,
                    0.112505799470887,
                    0.091119023636374,
                    0.044550804361556};
        Wys[7] = new double[]{
                    0.050614268145188,
                    0.111190517226687,
                    0.156853322938944,
                    0.181341891689181,
                    0.181341891689181,
                    0.156853322938944,
                    0.111190517226687,
                    0.050614268145188};
        ts[7] = new double[]{
                    0.019855071751232,
                    0.101666761293187,
                    0.237233795041836,
                    0.408282678752175,
                    0.591717321247825,
                    0.762766204958164,
                    0.898333238706813,
                    0.980144928248768};

        xs[8] = new double[]{
                    0.036257812883210,
                    0.118078978789999,
                    0.237176984814960,
                    0.381882765304706,
                    0.538029598918989,
                    0.690332420072362,
                    0.823883343837005,
                    0.925612610290804,
                    0.985587590351124};
        wxs[8] = new double[]{
                    0.002180847085773,
                    0.012060004284785,
                    0.031804821491054,
                    0.058401195295165,
                    0.084358321844920,
                    0.100308809193368,
                    0.098533742172346,
                    0.076074255109308,
                    0.036278003523280};
        Wys[8] = new double[]{
                    0.040637194180787,
                    0.090324080347429,
                    0.130305348201468,
                    0.156173538520001,
                    0.165119677500630,
                    0.156173538520001,
                    0.130305348201468,
                    0.090324080347429,
                    0.040637194180787};
        ts[8] = new double[]{
                    0.015919880246187,
                    0.081984446336682,
                    0.193314283649705,
                    0.337873288298096,
                    0.500000000000000,
                    0.662126711701905,
                    0.806685716350295,
                    0.918015553663318,
                    0.984080119753813};

        xs[9] = new double[]{
                    0.030029032161487,
                    0.098289012209853,
                    0.199021078963101,
                    0.324055538323335,
                    0.463261234284339,
                    0.605360153114213,
                    0.738840323991544,
                    0.852888550356930,
                    0.938267928122852,
                    0.988082386567585};
        wxs[9] = new double[]{
                    0.001499140602406,
                    0.008419319782983,
                    0.022774591453263,
                    0.043401906407151,
                    0.066053075563350,
                    0.084557109690827,
                    0.092696893677724,
                    0.086211300289176,
                    0.064287154509083,
                    0.030099508024037};
        Wys[9] = new double[]{
                    0.033335672154344,
                    0.074725674575290,
                    0.109543181257991,
                    0.134633359654998,
                    0.147762112357376,
                    0.147762112357376,
                    0.134633359654998,
                    0.109543181257991,
                    0.074725674575290,
                    0.033335672154344};
        ts[9] = new double[]{
                    0.013046735741414,
                    0.067468316655508,
                    0.160295215850488,
                    0.283302302935376,
                    0.425562830509184,
                    0.574437169490816,
                    0.716697697064624,
                    0.839704784149512,
                    0.932531683344492,
                    0.986953264258586};
    }
    private static double[]Wx=new double[10];
    public static double triangleQuadrate(BivariateRealFunction fun,int n,double x1,double y1,double x2,double y2,double x3,double y3) throws ArgumentOutsideDomainException {
        if(n<1||n>10){
            throw new ArgumentOutsideDomainException(n, 0, 10);
        }
        double []x=xs[n-1];
        double []Wy=Wys[n-1];
        double []t=ts[n-1];
        double []wx=wxs[n-1];
        double t1=Math.abs((-x1+x3)*(y2-y3)+(y1-y3)*(x2-x3));
        for(int i=0;i<n;i++){
            Wx[i]=t1*wx[i];
        }
        double result=0;
        double xij,yij;
        for(int i=0;i<n;i++){
            for(int j=0;j<n;j++){
                xij=x1+x2*x[i]+x3*t[j]*x[i];
                yij=y1+y2*x[i]+y3*t[j]*x[i];
                result+=Wx[i]*fun.value(xij, yij)*Wy[j];
            }
        }

        return result;

//        % >>[X,Y,Wx,Wy]=triquad(8,[0 0; 0 2; 2 1])
//% >>f=@(x,y) exp(x+y);
//% >>Q=Wx'*feval(f,X,Y)*Wy;
//cd=[ 1, 0, 0; -1, 0, 1; 0, 1,-1]*v;
//  Wx=abs(det(cd(2:3,:)))*wx;
//
//[tt,xx]=meshgrid(t,x); yy=tt.*xx;
//X=cd(1,1)+cd(2,1)*xx+cd(3,1)*yy;    Y=cd(1,2)+cd(2,2)*xx+cd(3,2)*yy;


    }

    public static void main(String[] args) throws ArgumentOutsideDomainException{
        new TriangleQuadrature();
        double t;
        
            t=TriangleQuadrature.triangleQuadrate(new BivariateRealFunction() {

                @Override
                public double value(double x, double y){
                    return x;
                }
            },10, 0, 0, 100, 20, 400, 0);
        System.out.println("t = " + t);
    }
}
